<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE jasperReport PUBLIC "-//JasperReports//DTD Report Design//EN"
        "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">

<jasperReport name="FacturasPorCliente" language="java"
              pageWidth="842" pageHeight="595" columnWidth="802"
              leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">

    <!-- Campos que vienen de Factura (data source es lista de Factura) -->
    <field name="clienteNombre"        class="java.lang.String"/>
    <field name="numeroFactura"        class="java.lang.String"/>
    <field name="fechaDate"            class="java.util.Date"/>
    <field name="importeTotal"         class="java.math.BigDecimal"/>
    <field name="importeTotalConIVA"   class="java.math.BigDecimal"/>

    <!-- Variables para totales por cliente y total general -->
    <variable name="TotalCliente" class="java.math.BigDecimal"
              resetType="Group" resetGroup="GrupoCliente" calculation="Sum">
        <variableExpression><![CDATA[$F{importeTotalConIVA}]]></variableExpression>
    </variable>

    <variable name="TotalGeneral" class="java.math.BigDecimal"
              resetType="Report" calculation="Sum">
        <variableExpression><![CDATA[$F{importeTotalConIVA}]]></variableExpression>
    </variable>

    <!-- ================= GRUPO POR CLIENTE ================= -->
    <group name="GrupoCliente">
        <groupExpression><![CDATA[$F{clienteNombre}]]></groupExpression>
        <groupHeader>
            <band height="30">

                <rectangle>
                    <reportElement x="0" y="5" width="802" height="25"
                                   backcolor="#F0F0F0" mode="Opaque"/>
                </rectangle>

                <!-- Nombre del cliente -->
                <staticText>
                    <reportElement x="10" y="8" width="80" height="15"/>
                    <textElement>
                        <font size="10" isBold="true"/>
                    </textElement>
                    <text><![CDATA[Cliente:]]></text>
                </staticText>

                <textField>
                    <reportElement x="90" y="8" width="500" height="15"/>
                    <textElement>
                        <font size="10" isBold="true"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$F{clienteNombre}]]></textFieldExpression>
                </textField>

            </band>
        </groupHeader>

        <groupFooter>
            <band height="25">

                <!-- Total por cliente -->
                <staticText>
                    <reportElement x="520" y="5" width="130" height="15"/>
                    <textElement textAlignment="Right">
                        <font size="9" isBold="true"/>
                    </textElement>
                    <text><![CDATA[Total cliente (c/ IVA):]]></text>
                </staticText>

                <textField pattern="C$ #,##0.00">
                    <reportElement x="660" y="5" width="130" height="15"/>
                    <textElement textAlignment="Right">
                        <font size="9" isBold="true"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$V{TotalCliente}]]></textFieldExpression>
                </textField>

            </band>
        </groupFooter>
    </group>

    <background>
        <band/>
    </background>

    <!-- ================= TÍTULO / ENCABEZADO ================= -->
    <title>
        <band height="80">

            <rectangle>
                <reportElement x="0" y="0" width="802" height="60"
                               backcolor="#F5F5F5" mode="Opaque"/>
            </rectangle>

            <!-- Logo -->
            <image>
                <reportElement x="20" y="5" width="50" height="50"/>
                <imageExpression class="java.lang.String"><![CDATA["C:/Users/intim/Downloads/logo_ferreteria.jpg"]]></imageExpression>
            </image>

            <!-- Nombre ferretería -->
            <staticText>
                <reportElement x="80" y="10" width="300" height="20"/>
                <textElement>
                    <font size="16" isBold="true"/>
                </textElement>
                <text><![CDATA[Ferretería Vanessa]]></text>
            </staticText>

            <!-- Subtítulo -->
            <staticText>
                <reportElement x="80" y="32" width="300" height="16"/>
                <textElement>
                    <font size="11" isItalic="true"/>
                </textElement>
                <text><![CDATA[Ventas por cliente]]></text>
            </staticText>

            <!-- Fecha del reporte -->
            <staticText>
                <reportElement x="620" y="10" width="60" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Fecha:]]></text>
            </staticText>
            <textField pattern="dd/MM/yyyy">
                <reportElement x="680" y="10" width="100" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>

        </band>
    </title>

    <!-- ================= ENCABEZADO DE COLUMNAS ================= -->
    <columnHeader>
        <band height="20">

            <rectangle>
                <reportElement x="0" y="0" width="802" height="20"
                               backcolor="#EDEDED" mode="Opaque"/>
            </rectangle>

            <!-- N° factura -->
            <staticText>
                <reportElement x="30" y="2" width="140" height="15"/>
                <textElement>
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Número de factura]]></text>
            </staticText>

            <!-- Fecha -->
            <staticText>
                <reportElement x="200" y="2" width="90" height="15"/>
                <textElement textAlignment="Center">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Fecha]]></text>
            </staticText>

            <!-- Monto sin IVA -->
            <staticText>
                <reportElement x="350" y="2" width="130" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Monto]]></text>
            </staticText>

            <!-- Monto con IVA -->
            <staticText>
                <reportElement x="520" y="2" width="130" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Monto c/ IVA]]></text>
            </staticText>

        </band>
    </columnHeader>

    <!-- ================= DETALLE: cada factura ================= -->
    <detail>
        <band height="18">

            <!-- N° factura -->
            <textField>
                <reportElement x="30" y="2" width="140" height="14"/>
                <textElement>
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{numeroFactura}]]></textFieldExpression>
            </textField>

            <!-- Fecha -->
            <textField pattern="dd/MM/yyyy">
                <reportElement x="200" y="2" width="90" height="14"/>
                <textElement textAlignment="Center">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{fechaDate}]]></textFieldExpression>
            </textField>

            <!-- Monto sin IVA -->
            <textField pattern="C$ #,##0.00">
                <reportElement x="350" y="2" width="130" height="14"/>
                <textElement textAlignment="Right">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{importeTotal}]]></textFieldExpression>
            </textField>

            <!-- Monto con IVA -->
            <textField pattern="C$ #,##0.00">
                <reportElement x="520" y="2" width="130" height="14"/>
                <textElement textAlignment="Right">
                    <font size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{importeTotalConIVA}]]></textFieldExpression>
            </textField>

        </band>
    </detail>

    <!-- ================= RESUMEN GENERAL ================= -->
    <summary>
        <band height="40">

            <line>
                <reportElement x="0" y="0" width="802" height="1" forecolor="#999999"/>
            </line>

            <staticText>
                <reportElement x="520" y="10" width="130" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Total general (c/ IVA):]]></text>
            </staticText>

            <textField pattern="C$ #,##0.00">
                <reportElement x="660" y="10" width="130" height="15"/>
                <textElement textAlignment="Right">
                    <font size="9" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$V{TotalGeneral}]]></textFieldExpression>
            </textField>

        </band>
    </summary>

</jasperReport>
